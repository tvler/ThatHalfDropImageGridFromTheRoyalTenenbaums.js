"use strict";var _halfdrop={};_halfdrop.defaultValues={src:"",snap:false,maxWidth:-1,minWidth:0,width:0,maxHeight:-1,minHeight:0,height:0,keepRatio:true,ratio:0,oldWidth:0,oldHeight:0};_halfdrop.init=function(){_halfdrop.elems=document.querySelectorAll("[data-halfdrop]");_halfdrop.imgs=[];_halfdrop.settings=[];for(var j=0;j<this.elems.length;j++){var elem=this.elems[j],elemSettings=elem.getAttribute("data-halfdrop"),img=new Image,defVals=this.extend(this.defaultValues,{});if(!elemSettings){defVals.maxWidth=defVals.maxHeight="100%";this.settings[j]=this.extend(defVals,{});this.settings[j].src=elem.style.backgroundImage||window.getComputedStyle(elem,null).backgroundImage;this.settings[j].src=this.settings[j].src.replace("url(","").replace(")","").replace("'","").replace('"',"").replace("'","").replace('"',"");elem.style.background=""}else if(elemSettings[0]==="{"){elemSettings=JSON.parse(elemSettings);if(elemSettings.minWidth||elemSettings.maxWidth||elemSettings.width||elemSettings.minHeight||elemSettings.maxHeight||elemSettings.height||elemSettings.snap){if(defVals.maxWidth===-1)defVals.maxWidth=0;if(defVals.maxHeight===-1)defVals.maxHeight=0}else{defVals.maxWidth=defVals.maxHeight="100%"}this.settings[j]=this.extend(defVals,elemSettings||{});if(!this.settings[j].src){this.settings[j].src.replace("url(","").replace(")","").replace("'","").replace('"',"").replace("'","").replace('"',"")}}else{defVals.maxWidth=defVals.maxHeight="100%";this.settings[j]=this.extend(defVals,{});this.settings[j].src=elemSettings}if(this.settings[j].width&&this.settings[j].height){this.settings[j].keepRatio=false}img.setAttribute("data-index",j);img.onload=_halfdrop.paintBack;img.src=this.settings[j].src;this.imgs.push(img)}};_halfdrop.update=function(){for(var j=0;j<_halfdrop.elems.length;j++){_halfdrop.imgs[j].onload()}};_halfdrop.paintBack=function(){var index=parseInt(this.getAttribute("data-index")),elem=_halfdrop.elems[index],settings=_halfdrop.settings[index],elemW=elem.offsetWidth,elemH=elem.offsetHeight,url='url("'+this.src+'") repeat-y ',style="",imgW=this.naturalWidth,imgH=this.naturalHeight,size;if(settings.oldWidth&&settings.oldWidth===elemW&&settings.oldHeight===elemH){return}settings.oldWidth=elemW;settings.oldHeight=elemH;if(!settings.ratio){settings.ratio=this.width/this.height}if(settings.keepRatio){if(settings.width){imgW=_halfdrop.parseInput(settings.width,elemW);imgH=imgW/settings.ratio}else if(settings.height){imgH=_halfdrop.parseInput(settings.height,elemH);imgW=imgH*settings.ratio}if(settings.minWidth&&imgW<(size=_halfdrop.parseInput(settings.minWidth,elemW))){imgW=size;imgH=imgW/settings.ratio}if(settings.minHeight&&imgH<(size=_halfdrop.parseInput(settings.minHeight,elemH))){imgH=size;imgW=imgH*settings.ratio}if(settings.maxWidth&&imgW>(size=_halfdrop.parseInput(settings.maxWidth,elemW))){imgW=size;imgH=imgW/settings.ratio}if(settings.maxHeight&&imgH>(size=_halfdrop.parseInput(settings.maxHeight,elemH))){imgH=size;imgW=imgH*settings.ratio}}else{imgW=_halfdrop.parseInput(settings.width,elemW);imgH=_halfdrop.parseInput(settings.height,elemH);if(settings.minWidth&&imgW<(size=_halfdrop.parseInput(settings.minWidth,elemW))){imgW=size}if(settings.minHeight&&imgH<(size=_halfdrop.parseInput(settings.minHeight,elemH))){imgH=size}if(settings.maxWidth&&imgW>(size=_halfdrop.parseInput(settings.maxWidth,elemW))){imgW=size}if(settings.maxHeight&&imgH>(size=_halfdrop.parseInput(settings.maxHeight,elemH))){imgH=size}}if(settings.snap){if(settings.maxWidth&&settings.maxHeight){var snapWidth=Math.min(_halfdrop.parseInput(settings.maxWidth,elemW),_halfdrop.parseInput(settings.maxHeight,elemH)*settings.ratio);var floorOrCeil=Math.ceil}else if(settings.maxWidth){var snapWidth=_halfdrop.parseInput(settings.maxWidth,elemW);var floorOrCeil=Math.ceil}else if(settings.maxHeight){var snapWidth=_halfdrop.parseInput(settings.maxHeight,elemH)*settings.ratio;var floorOrCeil=Math.ceil}else if(settings.minWidth&&settings.minHeight){var snapWidth=Math.max(_halfdrop.parseInput(settings.minWidth,elemW),_halfdrop.parseInput(settings.minHeight,elemH)*settings.ratio);var floorOrCeil=Math.floor}else if(settings.minWidth){var snapWidth=_halfdrop.parseInput(settings.minWidth,elemW);var floorOrCeil=Math.floor}else if(settings.minHeight){var snapWidth=_halfdrop.parseInput(settings.minHeight,elemH)*settings.ratio;var floorOrCeil=Math.floor}else{var snapWidth=elemW/3;var floorOrCeil=Math.ceil}var snapRows=floorOrCeil((elemW/snapWidth-1)/2)*2+1;if(snapRows<3)snapRows=3;imgW=elemW/snapRows;imgH=imgW/settings.ratio}imgW=Math.ceil(imgW);imgH=Math.ceil(imgH);var vert=" / "+imgW+"px "+imgH+"px, ",center=Math.ceil((elemW-imgW)/2),amount=Math.floor(Math.ceil(elemW/imgW)/2),i=1,rows=2*amount+1,place;while(i<=amount){place="px "+elemH/2+"px"+vert;style+=url+(center+i*imgW)+place+url+(center-i*imgW)+place;i+=2}style+='url("'+this.src+'") repeat '+center+"px 50%"+vert;style=style.slice(0,-2);elem.style.background=style};_halfdrop.extend=function(){var extended={};var deep=false;var i=0;var length=arguments.length;if(Object.prototype.toString.call(arguments[0])==="[object Boolean]"){deep=arguments[0];i++}var merge=function(obj){for(var prop in obj){if(Object.prototype.hasOwnProperty.call(obj,prop)){if(deep&&Object.prototype.toString.call(obj[prop])==="[object Object]"){extended[prop]=extend(true,extended[prop],obj[prop])}else{extended[prop]=obj[prop]}}}};for(;i<length;i++){var obj=arguments[i];merge(obj)}return extended};_halfdrop.parseInput=function(inp,elemW){var unit="px";var num=parseFloat(inp);if(isNaN(inp)){var unit=(inp.match(/(%|px)$/)||["px"])[0]}if(unit==="%"){num*=elemW/100}return num};if(document.readyState!=="loading"){_halfdrop.init()}else{document.addEventListener("DOMContentLoaded",function(){_halfdrop.init()})}
